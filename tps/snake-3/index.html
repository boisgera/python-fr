<!DOCTYPE html>

<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<script>
        window.MathJax = {
          tex: {
            tags: 'ams'
          }
        };
       </script>

<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="SÃ©bastien BoisgÃ©rault, MINES Paris â€“ PSL" name="author"/>
<title>Le retour du retour du serpent</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
<link href="css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script>

      function filterConsole(text) {
          let lines = text.split("\n");

          console.log(lines);

          let pythonConsole = lines && lines[0].startsWith(">>>");
          if (!pythonConsole) {
              return text + "\n\n";
          } else {
              let newLines = [];
              for (let line of lines) {
                  if (line.startsWith(">>> ") || line.startsWith("... ")) {
                      newLines.push(line.slice(4));
                  } else if (line.startsWith("...")){
                      newLines.push(line.slice(3));
                  }

              }
              return newLines.join("\n") + "\n";
          }

      }

      document.addEventListener("DOMContentLoaded", (event) => {
          let codeBlocks = document.querySelectorAll("pre.python")
          for (let codeBlock of codeBlocks) {

              let button = document.createElement("button")
              let icon = document.createElement("img");
              button.appendChild(icon)
              codeBlock.insertBefore(button, codeBlock.firstChild);

              icon.setAttribute("src", "icons/copy.svg");
              icon.setAttribute("style", "opacity: 0.5;")
              button.addEventListener('click', (event) => {
                  let text = button.nextElementSibling.textContent;
                  text = filterConsole(text);
                  navigator.clipboard.writeText(text);
              });

              codeBlock.setAttribute("style", "position: relative");
              button.setAttribute("style", 
              "position: absolute; right: 1em; top: 1em; opacity: 0.0;");

              codeBlock.addEventListener("mouseover", (event) => {
                  button.style.setProperty("transition", "opacity 0.1s ease-out");
                  button.style.setProperty("opacity", "1.0");
              });

              codeBlock.addEventListener("mouseout", (event) => {
                  button.style.setProperty("transition", "opacity 0.75s ease-out");
                  button.style.setProperty("opacity", "0.0");
              });

              button.addEventListener("mouseover", (event) => {
                  icon.style.setProperty("transition", "opacity 0.1s ease-out");
                  icon.style.setProperty("opacity", "0.75");
              })

              button.addEventListener("mouseout", (event) => {
                  icon.style.setProperty("transition", "opacity 0.75s ease-out");
                  icon.style.setProperty("opacity", "0.5");
              })


          }
      });    
  </script>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Le retour du retour du serpent</h1>
<p class="author"><a href="mailto:Sebastien.Boisgerault@minesparis.psl.eu">SÃ©bastien
BoisgÃ©rault</a>, MINES Paris â€“ PSL</p>
<p class="date">Vendredi 27 mai 2022</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/github.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr">
          https://github.com/boisgera/python-fr
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/git.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/commit/a346678">
          #a346678
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/edit.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/edit/master/tps/snake-3/index.md">
          Edition
        </a>
</p>
</header>
<details>
<summary>
<h2>Table des matiÃ¨res</h2>
</summary>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction" id="toc-introduction">ğŸ•¹ï¸
Introduction</a></li>
<li><a href="#validation" id="toc-validation">âœ”ï¸ Validation</a></li>
<li><a href="#un-type-snake" id="toc-un-type-snake">ğŸ Un type
<code>Snake</code></a></li>
<li><a href="#en-mouvement" id="toc-en-mouvement">ğŸƒ En
mouvement</a></li>
<li><a href="#etat-du-jeu" id="toc-etat-du-jeu">ğŸ—ƒï¸ Etat du jeu</a></li>
<li><a href="#constantes" id="toc-constantes">ğŸ§± Constantes</a></li>
<li><a href="#moteur-de-jeu" id="toc-moteur-de-jeu">âš™ï¸ Moteur de
jeu</a></li>
<li><a href="#pilote-automatique" id="toc-pilote-automatique">ğŸ¤– Pilote
automatique</a></li>
</ul>
</nav></details>


<h1 id="introduction">ğŸ•¹ï¸ Introduction</h1>
<p>Nous allons remanier (Ã  nouveau !) le jeu <a href="../snake-2/solutions/snake-v2.4.py">ğŸ snake.py</a>, en exploitant
une conception orientÃ©e objet. Nous tenterons de rendre son code plus
robuste / rÃ©utilisable / comprÃ©hensible / maintenable. Nous tÃ¢cherons
ensuite de tirer les bÃ©nÃ©fices de cette rÃ©organisation en dÃ©veloppant â€“
avec le minimum dâ€™effort de dÃ©veloppement â€“ un ğŸ¤– bot qui assistera le
joueur dans la poursuite du high-score.</p>
<h1 id="validation">âœ”ï¸ Validation</h1>
<p>Quelles sont les valeurs admissibles pour la direction du serpent ?
ImplÃ©menter une fonction <code>check_direction</code> qui prenne en
argument une direction, ne renvoie rien si la direction est admissible
et lÃ¨ve une exception (de type <code>ValueError</code> ou
<code>TypeError</code>, Ã  dÃ©terminer) dans le cas contraire.</p>
<p>De mÃªme, toutes les listes de n-uplets reprÃ©sentant la gÃ©omÃ©trie du
serpent ne sont pas valides. Faire la liste des toutes les conditions
qui rendent la gÃ©omÃ©trie du serpent invalide ; on distinguera les</p>
<ul>
<li><p>ğŸ› <strong>bugs</strong> qui rÃ©sultent dâ€™erreurs de programmation
et ne devraient pas exister,</p></li>
<li><p>ğŸ’€ <strong>game over</strong> qui peuvent arriver mais doivent
entrainer la fin immÃ©diate du jeu.</p></li>
</ul>
<p>Mettre en correspondance ces catÃ©gories avec un type dâ€™exception
(soit <code>TypeError</code>, soit <code>ValueError</code>, soit
<code>SystemExit</code>), puis implÃ©menter une fonction
<code>check_geometry</code> qui prenne en argument une gÃ©omÃ©trie de
serpent, ne renvoie rien si elle est valide et lÃ¨ve lâ€™exception
appropriÃ©e dans le cas contraire.</p>
<h1 id="un-type-snake">ğŸ Un type <code>Snake</code></h1>
<p>ImplÃ©menter une classe <code>Snake</code> encapsulant la gÃ©omÃ©trie et
la direction du serpent :</p>
<pre><code>&gt;&gt;&gt; geometry = [(10, 15), (11, 15), (12, 15)]
&gt;&gt;&gt; direction = (0, 1)
&gt;&gt;&gt; snake = Snake(geometry, direction)</code></pre>
<p>Le constructeur de <code>Snake</code> doit valider la gÃ©omÃ©trie et la
direction (ou lever une exception). Stocker les arguments
<code>geometry</code> et <code>direction</code> comme les attributs de
mÃªme nom de lâ€™instance snake.</p>
<pre><code>&gt;&gt;&gt; snake.geometry
[(10, 15), (11, 15), (12, 15)]
&gt;&gt;&gt; snake.direction
(0, 1)</code></pre>
<p>A-tâ€™on la garantie que ces attributs restent valides quel que soit
lâ€™usage que le programmeur fasse de lâ€™instance <code>snake</code> dans
son code ? Faire disparaÃ®tre les attributs publics <code>geometry</code>
et <code>direction</code> au profit dâ€™attributs privÃ©s
<code>_geometry</code> et <code>_direction</code>, puis dÃ©velopper des
mÃ©thodes <code>get_direction</code> et <code>set_direction</code>
permettant dâ€™accÃ©der Ã  lâ€™attribut <code>_direction</code> en assurant sa
validitÃ©</p>
<pre><code>&gt;&gt;&gt; snake.get_direction()
(0, 1)
&gt;&gt;&gt; snake.set_direction((0, -1))
&gt;&gt;&gt; snake.get_direction()
(0, -1)</code></pre>
<p>La mÃªme stratÃ©gie peut-Ãªtre sâ€™appliquer au cas de lâ€™attribut
<code>_geometry</code> ou doit-elle Ãªtre modifiÃ©e pour garantir la
validitÃ© de cet attribut privÃ© dans le temps ? Si câ€™est le cas, comment
?</p>
<p>Enfin, associer aux accesseurs <code>get_direction</code>,
<code>set_direction</code>, <code>get_geometry</code> et
<code>set_geometry</code> des propriÃ©tÃ©s <code>geometry</code> et
<code>direction</code> et adapter le code client en consÃ©quence.</p>
<h1 id="en-mouvement">ğŸƒ En mouvement</h1>
<p>Introduire une mÃ©thode <code>move</code> dans la classe
<code>Snake</code> qui va mettre Ã  jour la gÃ©omÃ©trie du serpent en
tenant compte de la direction courante du serpent et de la position des
fruits (Ã  remettre Ã  jour le cas Ã©chÃ©ant).</p>
<p>Adapter la boucle gÃ©nÃ©rale du programme <a href="../snake-2/solutions/snake-v2.4.py">ğŸ snake.py</a> pour intÃ©grer
les dÃ©veloppements de la classe <code>Snake</code>. VÃ©rifier en y jouant
que le comportement du jeu reste identique.</p>
<h1 id="etat-du-jeu">ğŸ—ƒï¸ Etat du jeu</h1>
<p>DÃ©finir une classe <code>State</code> reprÃ©sentant lâ€™Ã©tat Ã  un
instant donnÃ© du programme. On souhaite pouvoir initialiser cet Ã©tat par
un code de la forme</p>
<pre class="python"><code>state = State(
    snake=Snake([(10, 15), (11, 15), (12, 15)], DIRECTIONS["RIGHT"]), 
    fruit=(10, 10)
)</code></pre>
<p>et que lâ€™instance <code>state</code> expose les attributs
<code>snake</code> et <code>fruit</code> (en lecture et en
Ã©criture).</p>
<p>Adapter le reste du code en consÃ©quence. A-tâ€™on encore besoin du
mot-clÃ© <code>global</code> ? Pourquoi ?</p>
<p>Quelle autre type de fonctionnalitÃ© pourrait Ãªtre prise en charge par
la classe <code>State</code> ?</p>
<h1 id="constantes">ğŸ§± Constantes</h1>
<p>ğŸ§¹ <strong>Nettoyage de printemps !</strong> DÃ©placer la dÃ©finition
des constantes du programme (<code>W, H, X, ...</code>) dans un fichier
Ã  part, <code>constants.py</code>, puis les importer dans
<code>snake.py</code> avec :</p>
<pre class="python"><code>from constants import *</code></pre>
<p>ğŸ“„ Solution : <a href="solutions/constants.py">constants.py</a></p>
<h1 id="moteur-de-jeu">âš™ï¸ Moteur de jeu</h1>
<p>On souhaite dÃ©sormais sÃ©parer aussi nettement que possible le code
qui relÃ¨ve spÃ©cifiquement de notre jeu et le code gÃ©nÃ©rique, commun Ã 
(presque) tous les jeux. Ce dernier type de code formera les bases dâ€™un
moteur de jeu et sera dÃ©veloppÃ© dans une classe <code>Game</code> du
fichier <code>game.py</code>. Cette classe devra prendre en charge
lâ€™initialisation de <code>pygame</code>, la gestion des fps, la
rÃ©cupÃ©ration des Ã©vÃ¨nements, etc.</p>
<p>On souhaite pouvoir exploiter cette classe gÃ©nÃ©rique en dÃ©finissant
une classe <code>SnakeGame</code> qui en dÃ©rive et qui rÃ©git le jeu du
serpent. <code>SnakeGame</code> sera dÃ©finie de la faÃ§on suivante
(fichier complet : ğŸ“„ <a href="solutions/snake.py">snake.py</a>) :</p>
<pre class="python"><code>from game import Game

class SnakeGame(Game):
    def process_events(self, events):
        snake = state.snake
        for event in events:
            if (
                event.type == pg.QUIT
                or event.type == pg.KEYDOWN
                and event.key == pg.K_q
            ):
                self.quit()
            elif event.type == pg.KEYDOWN:
                if event.key == pg.K_DOWN:
                    snake.direction = DIRECTIONS["DOWN"]
                elif event.key == pg.K_UP:
                    snake.direction = DIRECTIONS["UP"]
                elif event.key == pg.K_RIGHT:
                    snake.direction = DIRECTIONS["RIGHT"]
                elif event.key == pg.K_LEFT:
                    snake.direction = DIRECTIONS["LEFT"]
        try:
            snake.move()
        except SystemExit as error:
            message = error.args[0]
            self.quit(error=message)

    def draw(self):
        snake = state.snake
        fruit_x, fruit_y = state.fruit
        self.caption = f"Score: {len(snake.geometry)}"
        draw_background(self.screen)
        for x, y in snake.geometry:
            draw_tile(self.screen, x, y, SNAKE_COLOR)
        draw_tile(self.screen, fruit_x, fruit_y, FRUIT_COLOR)</code></pre>
<p>Lorsque lâ€™on invoque la commande <code>python snake.py</code>, le
code suivant sera exÃ©cutÃ© :</p>
<pre class="python"><code>snake_game = SnakeGame(size=(X * W, Y * H), fps=FPS)
snake_game.start()</code></pre>
<p>DÃ©velopper la classe <code>Game</code> en consÃ©quence !</p>
<p>ğŸ“„ Solution : <a href="solutions/game.py">game.py</a></p>
<h1 id="pilote-automatique">ğŸ¤– Pilote automatique</h1>
<p>On souhaite faciliter la vie du joueur: lorsque celui-ci ne presse
aucune touche pendant une frame, votre programme devra prendre une
dÃ©cision Ã  sa place pour le rapprocher du fruit, en Ã©vitant de crÃ©er
trop de collisions (au minimum: en ne faisant jamais un demi-tour).</p>
<p>DÃ©velopper une classe ğŸ¤– <code>AutoSnakeGame</code> qui prenne en
charge cette fonctionnalitÃ© quand on lance le jeu avec la commande
<code>python autosnake.py</code>.</p>
<pre class="python"><code># Third-Party Libraries
import pygame as pg

# Local Modules
from constants import *
from snake import state, SnakeGame

class AutoSnakeGame(SnakeGame):
    pass # TODO!

snake_game = AutoSnakeGame(size=(X * W, Y * H), fps=FPS)
snake_game.start()</code></pre>
<p>ğŸ“„ Solution : <a href="solutions/autosnake.py">autosnake.py</a></p>
</body>
</html>
