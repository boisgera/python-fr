<!DOCTYPE html>

<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<script>
        window.MathJax = {
          tex: {
            tags: 'ams'
          }
        };
       </script>

<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="S√©bastien Boisg√©rault, Mines Paris ‚Äì PSL" name="author"/>
<title>Le serpent</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
<link href="css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script>

      function filterConsole(text) {
          let lines = text.split("\n");

          console.log(lines);

          let pythonConsole = lines && lines[0].startsWith(">>>");
          if (!pythonConsole) {
              return text + "\n\n";
          } else {
              let newLines = [];
              for (let line of lines) {
                  if (line.startsWith(">>> ") || line.startsWith("... ")) {
                      newLines.push(line.slice(4));
                  } else if (line.startsWith("...")){
                      newLines.push(line.slice(3));
                  }

              }
              return newLines.join("\n") + "\n";
          }

      }

      document.addEventListener("DOMContentLoaded", (event) => {
          let codeBlocks = document.querySelectorAll("pre.python")
          for (let codeBlock of codeBlocks) {

              let button = document.createElement("button")
              let icon = document.createElement("img");
              button.appendChild(icon)
              codeBlock.insertBefore(button, codeBlock.firstChild);

              icon.setAttribute("src", "icons/copy.svg");
              icon.setAttribute("style", "opacity: 0.5;")
              button.addEventListener('click', (event) => {
                  let text = button.nextElementSibling.textContent;
                  text = filterConsole(text);
                  navigator.clipboard.writeText(text);
              });

              codeBlock.setAttribute("style", "position: relative");
              button.setAttribute("style", 
              "position: absolute; right: 1em; top: 1em; opacity: 0.0;");

              codeBlock.addEventListener("mouseover", (event) => {
                  button.style.setProperty("transition", "opacity 0.1s ease-out");
                  button.style.setProperty("opacity", "1.0");
              });

              codeBlock.addEventListener("mouseout", (event) => {
                  button.style.setProperty("transition", "opacity 0.75s ease-out");
                  button.style.setProperty("opacity", "0.0");
              });

              button.addEventListener("mouseover", (event) => {
                  icon.style.setProperty("transition", "opacity 0.1s ease-out");
                  icon.style.setProperty("opacity", "0.75");
              })

              button.addEventListener("mouseout", (event) => {
                  icon.style.setProperty("transition", "opacity 0.75s ease-out");
                  icon.style.setProperty("opacity", "0.5");
              })


          }
      });    
  </script>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Le serpent</h1>
<p class="author"><a href="mailto:Sebastien.Boisgerault@minesparis.psl.eu">S√©bastien
Boisg√©rault</a>, Mines Paris ‚Äì PSL</p>
<p class="date">Friday 25 august 2023</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/github.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr">
          https://github.com/boisgera/python-fr
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/git.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/commit/7da617f">
          #7da617f
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/edit.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/edit/master/tps/snake-1/index.md">
          Edition
        </a>
</p>
</header>
<details>
<summary>
<h2>Table des mati√®res</h2>
</summary>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#pr√©requis" id="toc-pr√©requis">Pr√©requis</a></li>
<li><a href="#avec-visual-studio-code" id="toc-avec-visual-studio-code">Avec Visual Studio Code</a></li>
<li><a href="#code-de-d√©marrage" id="toc-code-de-d√©marrage">Code de
d√©marrage</a></li>
<li><a href="#√©v√©nements" id="toc-√©v√©nements">√âv√©nements</a></li>
<li><a href="#le-damier" id="toc-le-damier">Le damier</a></li>
<li><a href="#un-serpent-fixe" id="toc-un-serpent-fixe">Un serpent
fixe</a></li>
<li><a href="#un-serpent-qui-bouge" id="toc-un-serpent-qui-bouge">Un
serpent qui bouge</a></li>
<li><a href="#le-fruit" id="toc-le-fruit">Le fruit</a></li>
<li><a href="#√©pilogue" id="toc-√©pilogue">√âpilogue</a></li>
<li><a href="#annexe-codes-rgb" id="toc-annexe-codes-rgb">Annexe ‚Äì Codes
RGB</a></li>
<li><a href="#r-g-b-couleur" id="toc-r-g-b-couleur">R G B
Couleur</a></li>
</ul>
</nav></details>


<hr/>
<p>üôè Projet original par Aur√©lien Noce (<a href="https://github.com/ushu"><span class="citation" data-cites="ushu">@ushu</span></a>).</p>
<hr/>
<h2 id="introduction">Introduction</h2>
<p>Ce TP vous propose de d√©velopper un petit jeu en Python. Il constitue
une introduction √† la conception et √† la r√©alisation d‚Äôun programme
complet.</p>
<p>Son sujet est un standard du jeu vid√©o, le üêç <a href="https://fr.wikipedia.org/wiki/Snake_(genre_de_jeu_vid%C3%A9o)">snake</a>.</p>
<figure>
<img alt="üéÆ Snake! ; une version classique du snake, r√©alis√©e avec la plate-forme de retro-gaming Python Pyxel." src="images/snake-pyxel.jpg"/>
<figcaption aria-hidden="true"><a href="https://kitao.github.io/pyxel/wasm/examples/07_snake.html">üéÆ
Snake!</a> ; une version classique du snake, r√©alis√©e avec la
plate-forme de retro-gaming Python <a href="https://github.com/kitao/pyxel">Pyxel</a>.</figcaption>
</figure>
<p>De nombreuses variantes de ce jeu existent ; <a href="https://slither.io">slither.io</a> est un bon exemple de snake
modernis√© (et notamment, massivement multijoueur !).</p>
<p>Rassurez-vous, notre objectif sera modeste et donc proche de la
version classique du jeu : nous r√©aliserons plusieurs versions d‚Äôun
<strong>programme qui marche</strong> (et pas un programme parfait) dont
les fonctionnalit√©s s‚Äôenrichiront √† chaque nouvelle √©tape.</p>
<h2 id="pr√©requis">Pr√©requis</h2>
<div class="warning">
<p>‚ö†Ô∏è Ce qui suit suppose que vous avez install√© Python avec
<code>conda</code> et que vous avez un terminal <code>bash</code>
fonctionnel sur votre ordinateur.</p>
</div>
<p>Commencez par cr√©er un environnement nomm√© <code>snake</code>, d√©di√©
au TP et contenant Python 3.10</p>
<pre class="bash"><code>(base) $ conda create -n snake python=3.10</code></pre>
<p>Puis activez-le</p>
<pre class="bash"><code>(base) $ conda activate snake</code></pre>
<p>Vous devriez alors avoir une nouvelle invite de commande :</p>
<pre><code>(snake) $</code></pre>
<details>
<summary>
<strong>D√©pannage üõ†Ô∏è</strong>
</summary>
<hr/>
<p>Si vous ne voyez pas l‚Äôinvite de commande <code>(snake) $</code>
alors</p>
<ol type="1">
<li><p>ex√©cutez la commande</p>
<pre class="bash"><code>$ conda init bash</code></pre>
<p>puis</p></li>
<li><p>cr√©ez un nouveau terminal.</p></li>
</ol>
<hr/>
</details>
<p>Installez ensuite le module <code>pygame</code> avec <code>pip</code>
dans cet environnement :</p>
<pre class="bash"><code>(snake) $ pip install pygame</code></pre>
<p>Pour tester votre installation, lancez le programme d‚Äôexemple :</p>
<pre class="bash"><code>(snake) $ python -m pygame.examples.aliens</code></pre>
<h2 id="avec-visual-studio-code">Avec Visual Studio Code</h2>
<p><strong>Suggestion #1.</strong>¬† Installez l‚Äô<a href="https://marketplace.visualstudio.com/items?itemName=ms-python.python">extension
de VS Code pour Python</a>.</p>
<p><strong>Suggestion #2.</strong> Indiquez √† VS Code (et pas uniquement
au terminal) qu‚Äôon souhaite travailler dans l‚Äôenvironnement conda
<code>snake</code> : cliquez dans la banni√®re du bas la zone qui indique
le Python courant.</p>
<h2 id="code-de-d√©marrage">Code de d√©marrage</h2>
<p>Notre point de d√©part : un arri√®re-plan dont la couleur varie
al√©atoirement.</p>
<pre class="python" data-output="snake-1.py"><code>import random
import pygame

pygame.init()
screen = pygame.display.set_mode([300, 300])
clock = pygame.time.Clock()

while True:
    red = random.randint(0, 255)
    green = random.randint(0, 255)
    blue = random.randint(0, 255)
    color = [red, green, blue]
    screen.fill(color)
    pygame.display.update()
    clock.tick(1)</code></pre>
<p>Copiez ce code dans un fichier <code>snake.py</code> et
ex√©cutez-le¬†:</p>
<pre class="sh"><code>(snake) $ python snake.py</code></pre>
<div class="warning">
<p>‚ö†Ô∏è Pour quitter le programme tapez Control-C dans le terminal.</p>
</div>
<h3 id="exercices">Exercices</h3>
<ul>
<li><p>üóî <strong>Fen√™tre.</strong> Agrandissez la fen√™tre du jeu ‚Äì
initialement 300x300 ‚Äì pour adopter une taille de votre choix.</p></li>
<li><p>‚è≤Ô∏è <strong>Horloge.</strong> Dans l‚Äôappel √† la fonction
<code>clock.tick</code>,</p>
<ul>
<li><p>remplacez l‚Äôargument <code>1</code> par <code>2</code> (puis
ex√©cutez le programme),</p></li>
<li><p>proc√©dez de m√™me avec <code>5</code>,</p></li>
<li><p>puis supprimez (ou commentez) l‚Äôappel √†
<code>clock.tick</code>.</p></li>
</ul>
<p>Que se passe-t‚Äôil dans chaque cas ? A votre avis, quel est le r√¥le de
la fonction <code>clock.tick</code> et de son argument ?</p></li>
<li><p>üñåÔ∏è <strong>Affichage.</strong> Que se passe-t‚Äôil si l‚Äôon commente
la ligne <code>pygame.display.update()</code> ? Savez-vous expliquer ce
ph√©nom√®ne ?</p></li>
<li><p>üé® <strong>Couleurs.</strong> Faites en sorte que les couleurs
qui s‚Äôaffichent soient toujours al√©atoires, mais uniquement parmi des
nuances de bleu.</p>
<p>üóùÔ∏è On pourra consulter l‚Äôannexe <a href="#annexe-codes-rgb">‚ÄúCodes
RGB‚Äù</a>.</p></li>
</ul>
<h2 id="√©v√©nements">√âv√©nements</h2>
<p>Pygame permet de sp√©cifier comment r√©agir aux actions de
l‚Äôutilisateur, par exemple son utilisation du clavier ou de la
souris.</p>
<p>Nous pouvons ainsi faire en sorte de forcer l‚Äôarr√™t du programme
lorsque l‚Äôutilisateur clique sur le bouton de fermeture de la fen√™tre ou
appuie sur la touche Q :</p>
<pre class="python" data-output="snake-2.py"><code>import random
import sys
import pygame

pygame.init()
screen = pygame.display.set_mode([300, 300])
clock = pygame.time.Clock()

while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_q:
                pygame.quit()
                sys.exit()
    red = random.randint(0, 255)
    green = random.randint(0, 255)
    blue = random.randint(0, 255)
    color = [red, green, blue]
    screen.fill(color)
    pygame.display.update()
    clock.tick(1)</code></pre>
<p>Modifier ce programme pour que lorsque l‚Äôutilisateur presse les
fl√™ches de son clavier, le programme affiche (avec la fonction
<code>print</code>) les caract√®res <code>‚Üê</code>, <code>‚Üë</code>,
<code>‚Üí</code> ou <code>‚Üì</code> dans le terminal.</p>
<p>üóùÔ∏è Le code renvoy√© par la fl√™che vers le haut est
<code>pygame.K_UP</code> par exemple.</p>
<h2 id="le-damier">Le damier</h2>
<p>Nous allons commencer par construire notre plateau de jeu ainsi :</p>
<ul>
<li><p>le plateau de jeu est d√©coup√© en 30x30 cases,</p></li>
<li><p>chaque case fait 20 pixels de c√¥t√©.</p></li>
</ul>
<p>Pour v√©rifier la validit√© de ce plateau de jeu, √©crivez un programme
qui dessine un damier :</p>
<p><img src="images/damier.png"/></p>
<p>üóùÔ∏è Vous pouvez utiliser la m√©thode <a href="https://www.pygame.org/docs/ref/draw.html#pygame.draw.rect"><code>pygame.draw.rect</code></a>
:</p>
<pre class="python"><code>x = 100
y = 100
width = 30
height = 30
rect = [x, y, width, height]
red = 255
green = 0
blue = 0
color = [red, green, blue]
pygame.draw.rect(screen, color, rect)</code></pre>
<h2 id="un-serpent-fixe">Un serpent fixe</h2>
<p>L‚Äô√©tape suivante est de dessiner le serpent, comme une suite de
segments repr√©sent√©s par des rectangles color√©s. On veut dessiner le
serpent aux coordonn√©es suivantes :</p>
<pre class="python"><code>snake = [
    [10, 15],
    [11, 15],
    [12, 15],
]</code></pre>
<p>pour obtenir un sch√©ma comme suit ; disons pour fixer les id√©es que
dans ce cas de figure <code>[10, 15]</code> est la queue et
<code>[12, 15]</code> est la t√™te :</p>
<p><img src="images/serpent.png"/></p>
<details>
<summary>
<strong>Solution</strong>
</summary>
<pre class="python" data-output="snake-3.py"><code>import sys
import pygame

white = [255, 255, 255]
black = [0, 0, 0]
snake = [
[10, 15],
[11, 15],
[12, 15],
]

pygame.init()
screen = pygame.display.set_mode([20*30, 20*30])
clock = pygame.time.Clock()
while True:
for event in pygame.event.get():
if event.type == pygame.QUIT:
pygame.quit()
sys.exit()
elif event.type == pygame.KEYDOWN:
if event.key == pygame.K_q:
pygame.quit()
sys.exit()
screen.fill(white)
for x, y in snake:
rect = [x*20, y*20, 20, 20]
pygame.draw.rect(screen, black, rect)  
 pygame.display.update()
clock.tick(1)
</code></pre>
</details>
<h2 id="un-serpent-qui-bouge">Un serpent qui bouge</h2>
<p>Ensuite, nous allons faire bouger le serpent :</p>
<ul>
<li><p>nous cr√©ons un vecteur de ‚Äúdirection‚Äù, par exemple</p>
<pre class="python"><code>direction = [1, 0]</code></pre></li>
<li><p>√† chaque it√©ration de la boucle, nous pouvons d√©placer le serpent
dans cette direction en ‚Äúajoutant‚Äù ce vecteur √† la position de la t√™te
du serpent</p></li>
</ul>
<p><img src="images/serpent-bouge.gif"/></p>
<p>Une fois que le serpent bouge, ajouter les commandes pour se d√©placer
dans les 4 directions, en appuyant sur les touches de direction du
clavier.</p>
<p>Aussi on peut commencer √† envisager d‚Äôacc√©l√©rer un peu le jeu √† ce
stade ‚Ä¶</p>
<p><strong>Bonus.</strong> Faites en sorte que le serpent ne puisse pas
faire demi-tour.</p>
<details>
<summary>
<strong>Solution</strong>
</summary>
<pre class="python" data-output="snake-4.py"><code>import sys
import pygame

white = [255, 255, 255]
black = [0, 0, 0]
snake = [
    [10, 15],
    [11, 15],
    [12, 15],
]
direction = [1, 0]

pygame.init()
screen = pygame.display.set_mode([20*30, 20*30])
clock = pygame.time.Clock()
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_q:
                pygame.quit()
                sys.exit()
            if event.key == pygame.K_UP:
                direction = [0.0, -1.0]
            elif event.key == pygame.K_LEFT:
                direction = [-1.0, 0.0]
            elif event.key == pygame.K_DOWN:
                direction = [0.0, 1.0]
            elif event.key == pygame.K_RIGHT:
                direction = [1.0, 0.0]
    head = snake[-1]
    new_head = [
      head[0] + direction[0],
      head[1] + direction[1]
    ]
    snake = snake[1:] + [new_head]
    screen.fill(white)
    for x, y in snake:
        rect = [x*20, y*20, 20, 20]
        pygame.draw.rect(screen, black, rect)
    pygame.display.update()
    clock.tick(1)</code></pre>
</details>
<h2 id="le-fruit">Le fruit</h2>
<p>Il faut maintenant faire manger notre serpent. On va proc√©der comme
suit:</p>
<ul>
<li><p>on a toujours la position du serpent dans une variable
<code>snake</code> :</p></li>
<li><p>on g√©n√®re un ‚Äúfruit‚Äù, dans une position al√©atoire</p>
<pre class="python"><code>fruit = [10, 10]</code></pre></li>
<li><p>quand la t√™te du serpent mange le fruit, on place un nouveau
fruit √† une position al√©atoire et on allonge le serpent d‚Äôune case</p>
<p><img src="images/manger.gif"/></p></li>
</ul>
<details>
<summary>
<strong>Solution</strong>
</summary>
<pre class="python" data-output="snake-5.py"><code>import random
import sys
import pygame

white = [255, 255, 255]
black = [0, 0, 0]
red = [255, 0, 0]
snake = [
    [10, 15],
    [11, 15],
    [12, 15],
]
direction = [1, 0]
fruit = [10, 10]

pygame.init()
screen = pygame.display.set_mode([20*30, 20*30])
clock = pygame.time.Clock()
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_q:
                pygame.quit()
                sys.exit()
            if event.key == pygame.K_UP:
                direction = [0, -1]
            elif event.key == pygame.K_LEFT:
                direction = [-1, 0]
            elif event.key == pygame.K_DOWN:
                direction = [0, 1]
            elif event.key == pygame.K_RIGHT:
                direction = [1, 0]
    head = snake[-1]
    new_head = [
      head[0] + direction[0],
      head[1] + direction[1]
    ]
    if new_head == fruit:
        snake = snake + [new_head]
        fruit = [
            random.randint(0, 29),
            random.randint(0, 29)
        ]
    else:
        snake = snake[1:] + [new_head]
    screen.fill(white)
    for x, y in snake:
        rect = [x*20, y*20, 20, 20]
        pygame.draw.rect(screen, black, rect)
    rect = [fruit[0]*20, fruit[1]*20, 20, 20]
    pygame.draw.rect(screen, red, rect)
    pygame.display.update()
    clock.tick(1)</code></pre>
</details>
<h2 id="√©pilogue">√âpilogue</h2>
<p>Il nous reste deux petits changements pour avoir un serpent
compl√®tement fonctionnel :</p>
<ul>
<li><p>Il faut d√©tecter si le serpent se mord la queue, ou touche un des
murs, ce qui est une condition d‚Äô√©chec.</p></li>
<li><p>Enfin on peut afficher le score. La fa√ßon la plus simple de
proc√©der est de changer le titre de la fen√™tre, avec la fonction
<code>set_caption</code> :</p>
<pre class="python"><code>score = 0
pygame.display.set_caption(f"üêç Score: {score}")</code></pre></li>
</ul>
<details>
<summary>
<strong>Solution</strong>
</summary>
<pre class="python" data-output="snake-6.py"><code>import random
import sys
import pygame

white = [255, 255, 255]
black = [0, 0, 0]
red = [255, 0, 0]
snake = [
    [10, 15],
    [11, 15],
    [12, 15],
]
direction = [1, 0]
fruit = [10, 10]
score = 0

pygame.init()
screen = pygame.display.set_mode([20*30, 20*30])
clock = pygame.time.Clock()
while True:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_q:
                pygame.quit()
                sys.exit()
            if event.key == pygame.K_UP:
                direction = [0, -1]
            elif event.key == pygame.K_LEFT:
                direction = [-1, 0]
            elif event.key == pygame.K_DOWN:
                direction = [0, 1]
            elif event.key == pygame.K_RIGHT:
                direction = [1, 0]
    head = snake[-1]
    new_head = [
      head[0] + direction[0],
      head[1] + direction[1]
    ]
    if (
        new_head in snake
        or new_head[0] &lt; 0
        or new_head[0] &gt;= 30
        or new_head[1] &lt; 0
        or new_head[1] &gt;= 30
    ):
        pygame.quit()
        sys.exit()
    if new_head == fruit:
        score = score + 1
        snake = snake + [new_head]
        fruit = [
            random.randint(0, 29),
            random.randint(0, 29)
        ]
    else:
        snake = snake[1:] + [new_head]
    screen.fill(white)
    for x, y in snake:
        rect = [x*20, y*20, 20, 20]
        pygame.draw.rect(screen, black, rect)
    rect = [fruit[0]*20, fruit[1]*20, 20, 20]
    pygame.draw.rect(screen, red, rect)
    pygame.display.update()
    pygame.display.set_caption(f"üêç Score: {score}")
    clock.tick(1)</code></pre>
</details>
<h2 id="annexe-codes-rgb">Annexe ‚Äì Codes RGB</h2>
<p>La couleur d‚Äôun pixel est d√©crite par son <a href="https://fr.wikipedia.org/wiki/Rouge_vert_bleu">code RGB</a> : un
triplet d‚Äôentiers compris entre 0 et 255 qui d√©terminent l‚Äôintensit√© de
ses composantes rouge, verte et bleue. On a par exemple :</p>
<h2 id="r-g-b-couleur">R G B Couleur</h2>
<pre><code>   255           0           0      üü•
     0         255           0      üü©
     0           0         255      üü¶
   255         255         255      ‚¨ú
     0           0           0      ‚¨õ
   128          64           0      üü´
   255         128           0      üüß
   255         255           0      üü®
   106          13         173      üü™</code></pre>
</body>
</html>
