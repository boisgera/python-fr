<!DOCTYPE html>

<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<script>
        window.MathJax = {
          tex: {
            tags: 'ams'
          }
        };
       </script>

<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="SÃ©bastien BoisgÃ©rault, MINES Paris, UniversitÃ© PSL" name="author"/>
<title>Programmation OrientÃ©e Objet 2</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
<link href="css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script>

      function filterConsole(text) {
          let lines = text.split("\n");

          console.log(lines);

          let pythonConsole = lines && lines[0].startsWith(">>>");
          if (!pythonConsole) {
              return text + "\n\n";
          } else {
              let newLines = [];
              for (let line of lines) {
                  if (line.startsWith(">>> ") || line.startsWith("... ")) {
                      newLines.push(line.slice(4));
                  } else if (line.startsWith("...")){
                      newLines.push(line.slice(3));
                  }

              }
              return newLines.join("\n") + "\n";
          }

      }

      document.addEventListener("DOMContentLoaded", (event) => {
          let codeBlocks = document.querySelectorAll("pre.python")
          for (let codeBlock of codeBlocks) {

              let button = document.createElement("button")
              let icon = document.createElement("img");
              button.appendChild(icon)
              codeBlock.insertBefore(button, codeBlock.firstChild);

              icon.setAttribute("src", "icons/copy.svg");
              icon.setAttribute("style", "opacity: 0.5;")
              button.addEventListener('click', (event) => {
                  let text = button.nextElementSibling.textContent;
                  text = filterConsole(text);
                  navigator.clipboard.writeText(text);
              });

              codeBlock.setAttribute("style", "position: relative");
              button.setAttribute("style", 
              "position: absolute; right: 1em; top: 1em; opacity: 0.0;");

              codeBlock.addEventListener("mouseover", (event) => {
                  button.style.setProperty("transition", "opacity 0.1s ease-out");
                  button.style.setProperty("opacity", "1.0");
              });

              codeBlock.addEventListener("mouseout", (event) => {
                  button.style.setProperty("transition", "opacity 0.75s ease-out");
                  button.style.setProperty("opacity", "0.0");
              });

              button.addEventListener("mouseover", (event) => {
                  icon.style.setProperty("transition", "opacity 0.1s ease-out");
                  icon.style.setProperty("opacity", "0.75");
              })

              button.addEventListener("mouseout", (event) => {
                  icon.style.setProperty("transition", "opacity 0.75s ease-out");
                  icon.style.setProperty("opacity", "0.5");
              })


          }
      });    
  </script>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Programmation OrientÃ©e Objet 2</h1>
<p class="author"><a href="mailto:Sebastien.Boisgerault@minesparis.psl.eu">SÃ©bastien
BoisgÃ©rault</a>, MINES Paris, UniversitÃ© PSL</p>
<p class="date">Lundi 16 mai 2022</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/github.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr">
          https://github.com/boisgera/python-fr
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/git.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/commit/a35291c">
          #a35291c
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/edit.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/edit/master/cours/programmation-objet-2/index.md">
          Edition
        </a>
</p>
</header>
<details>
<summary>
<h2>Table des matiÃ¨res</h2>
</summary>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#todo" id="toc-todo">TODO</a></li>
<li><a href="#introduction-todo" id="toc-introduction-todo">Introduction
ğŸš§ TODO ğŸš§</a></li>
<li><a href="#typage-implicite" id="toc-typage-implicite">Typage
implicite</a>
<ul>
<li><a href="#exemple" id="toc-exemple">Exemple</a></li>
<li><a href="#analyse" id="toc-analyse">Analyse</a></li>
</ul></li>
</ul>
</nav></details>


<h1 id="todo">TODO</h1>
<ul>
<li><p>Polymorphism</p></li>
<li><p>Latent (â€œduckâ€) typing</p></li>
<li><p>Subtyping, inheritance</p></li>
<li><p>Examples in stdlib (duck typing, hierarchy, subtyping, etc.)
:</p>
<ul>
<li><p>file-like (filesystem, url, string buffer)</p></li>
<li><p>iterable</p></li>
<li><p>readline (?)</p></li>
<li><p>codecs (?)</p></li>
<li><p>datetime, zoneinfo</p></li>
<li><p>pickle/copy</p></li>
<li><p>random</p></li>
<li><p>tk</p></li>
<li><p>doctest</p></li>
</ul></li>
</ul>
<h1 id="introduction-todo">Introduction ğŸš§ TODO ğŸš§</h1>
<h1 id="typage-implicite">Typage implicite</h1>
<h2 id="exemple">Exemple</h2>
<p>La fonction <code>copy_file</code> lit le contenu dâ€™un objet fichier
et lâ€™Ã©crit dans un autre.</p>
<pre class="python"><code>def copy_file(input, output):
    data = input.read()
    output.write(data)</code></pre>
<p>CrÃ©ons un (tout petit) fichier binaire <code>image.png</code> sur
notre disque dur</p>
<pre class="python"><code>&gt;&gt;&gt; with open("image.png", mode="bw") as image_file:
...     image_file.write(b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x01\x03\x00\x00\x00f\xbc:%\x00\x00\x00\x03PLTE\xb5\xd0\xd0c\x04\x16\xea\x00\x00\x00\x1fIDATh\x81\xed\xc1\x01\r\x00\x00\x00\xc2\xa0\xf7Om\x0e7\xa0\x00\x00\x00\x00\x00\x00\x00\x00\xbe\r!\x00\x00\x01\x9a`\xe1\xd5\x00\x00\x00\x00IEND\xaeB`\x82')
...</code></pre>
<p>puis exploitons <code>copy_file</code> pour en crÃ©er un copie nommÃ©e
<code>image-copy.png</code>.</p>
<pre class="python"><code>&gt;&gt;&gt; input = open("image.png", mode="br")
&gt;&gt;&gt; output = open("image-copy.png", mode="bw")
&gt;&gt;&gt; copy_file(input, output)</code></pre>
<p>Tout se passe comme prÃ©vu ! NÃ©anmoins, on aurait pu faire lâ€™Ã©conomie
de la crÃ©ation du fichier initial et crÃ©er un objet similaire Ã  un
fichier, mais qui stocke son contenu en mÃ©moire plutÃ´t que sur notre
disque dur.</p>
<pre class="python"><code>&gt;&gt;&gt; import io
&gt;&gt;&gt; buffer = io.BytesIO(b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x01\x00\x00\x00\x01\x00\x01\x03\x00\x00\x00f\xbc:%\x00\x00\x00\x03PLTE\xb5\xd0\xd0c\x04\x16\xea\x00\x00\x00\x1fIDATh\x81\xed\xc1\x01\r\x00\x00\x00\xc2\xa0\xf7Om\x0e7\xa0\x00\x00\x00\x00\x00\x00\x00\x00\xbe\r!\x00\x00\x01\x9a`\xe1\xd5\x00\x00\x00\x00IEND\xaeB`\x82')
&gt;&gt;&gt; buffer.seek(0)</code></pre>
<p>(Lâ€™appel <code>buffer.seek(0)</code> repositionne le curseur de
lecture/Ã©criture au dÃ©but du fichier.)</p>
<p>On peut alors copier son contenu de la mÃªme faÃ§on que
prÃ©cÃ©demment</p>
<pre class="python"><code>&gt;&gt;&gt; input = buffer
&gt;&gt;&gt; output = open("image-copy.png", mode="bw")
&gt;&gt;&gt; copy_file(input, output)</code></pre>
<p>En fait lâ€™image originale est une tuile bleue-gris utilisÃ©e par le
projet de cartographie OpenStreetMap (cf.Â <a href="https://www.mjt.me.uk/posts/smallest-png/">â€œThe smallest 256x256
single-color PNG file, and where youâ€™ve seen itâ€</a>).</p>
<p>Elle est disponible en ligne Ã  lâ€™adresse <a class="uri" href="https://www.mjt.me.uk/assets/images/smallest-png/openstreetmap.png">https://www.mjt.me.uk/assets/images/smallest-png/openstreetmap.png</a>.
On aurait donc pu crÃ©er un objet similaire Ã  un fichier mais qui sait
ouvrir des ressources Web plutÃ´t que de recopier Ã  la main son
contenu.</p>
<pre class="python"><code>&gt;&gt;&gt; from urllib.requests import urlopen
&gt;&gt;&gt; url = "https://www.mjt.me.uk/assets/images/smallest-png/openstreetmap.png"
&gt;&gt;&gt; input = urlopen(url)</code></pre>
<p>A nouveau, la copie entre ce fichier distant et sa copie locale
sâ€™effectue comme prÃ©cÃ©demment.</p>
<pre class="python"><code>&gt;&gt;&gt; output = open("image-copy.png", mode="bw")
&gt;&gt;&gt; copy_file(input, output)</code></pre>
<h2 id="analyse">Analyse</h2>
<p>Ce qui compte dans les trois cas dâ€™usage prÃ©cÃ©dents, Ã§a nâ€™est pas que
lâ€™objet <code>input</code> soit un vrai fichier, mais quâ€™il se comporte
comme tel. Ici, trÃ¨s prÃ©cisÃ©ment la fonction <code>copy_file</code> a
besoin dâ€™un objet <code>input</code> qui :</p>
<ul>
<li><p>Ã  une mÃ©thode <code>read</code>,</p></li>
<li><p>qui sâ€™invoque sans argument,</p></li>
<li><p>et renvoie un objet de type <code>bytes</code>.</p></li>
</ul>
<p>Câ€™est tout ce que la fonction <code>copy_file</code> exige de son
argument <code>input</code> pour que Ã§a marche : quâ€™il soit suffisamment
similaire Ã  un â€œvraiâ€ fichier. On ne demande pas Ã  ce quâ€™il soit dâ€™un
type particulier, par exemple quâ€™il valide un test du type
<code>isinstance(input, File)</code>.</p>
<p>Ce concept moins exigeant de typage, câ€™est ce quâ€™en Python on appelle
le <strong>typage canard</strong> (ğŸ‡ºğŸ‡¸ <strong>duck typing</strong>)
dâ€™aprÃ¨s la citation attribuÃ©e Ã  James Whitcomb Riley</p>
<blockquote>
<p>When I see a bird that walks like a duck and swims like a duck and
quacks like a duck, I call that bird a duck. ğŸ¦†</p>
</blockquote>
<p>(Si je vois un oiseau qui vole comme un canard, nage comme un canard
et cancane comme un canard, alors jâ€™appelle cet oiseau un canard.)</p>
</body>
</html>
