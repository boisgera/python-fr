<!DOCTYPE html>

<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">
<head>
<script>
        window.MathJax = {
          tex: {
            tags: 'ams'
          }
        };
       </script>

<meta charset="utf-8"/>
<meta content="pandoc" name="generator"/>
<meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport"/>
<meta content="SÃ©bastien BoisgÃ©rault" name="author"/>
<title>ItÃ©ration &amp; comprÃ©hension</title>
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
<link href="css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script>

      function filterConsole(text) {
          let lines = text.split("\n");

          console.log(lines);

          let pythonConsole = lines && lines[0].startsWith(">>>");
          if (!pythonConsole) {
              return text + "\n\n";
          } else {
              let newLines = [];
              for (let line of lines) {
                  if (line.startsWith(">>> ") || line.startsWith("... ")) {
                      newLines.push(line.slice(4));
                  } else if (line.startsWith("...")){
                      newLines.push(line.slice(3));
                  }

              }
              return newLines.join("\n") + "\n";
          }

      }

      document.addEventListener("DOMContentLoaded", (event) => {
          let codeBlocks = document.querySelectorAll("pre.python")
          for (let codeBlock of codeBlocks) {

              let button = document.createElement("button")
              let icon = document.createElement("img");
              button.appendChild(icon)
              codeBlock.insertBefore(button, codeBlock.firstChild);

              icon.setAttribute("src", "icons/copy.svg");
              icon.setAttribute("style", "opacity: 0.5;")
              button.addEventListener('click', (event) => {
                  let text = button.nextElementSibling.textContent;
                  text = filterConsole(text);
                  navigator.clipboard.writeText(text);
              });

              codeBlock.setAttribute("style", "position: relative");
              button.setAttribute("style", 
              "position: absolute; right: 1em; top: 1em; opacity: 0.0;");

              codeBlock.addEventListener("mouseover", (event) => {
                  button.style.setProperty("transition", "opacity 0.1s ease-out");
                  button.style.setProperty("opacity", "1.0");
              });

              codeBlock.addEventListener("mouseout", (event) => {
                  button.style.setProperty("transition", "opacity 0.75s ease-out");
                  button.style.setProperty("opacity", "0.0");
              });

              button.addEventListener("mouseover", (event) => {
                  icon.style.setProperty("transition", "opacity 0.1s ease-out");
                  icon.style.setProperty("opacity", "0.75");
              })

              button.addEventListener("mouseout", (event) => {
                  icon.style.setProperty("transition", "opacity 0.75s ease-out");
                  icon.style.setProperty("opacity", "0.5");
              })


          }
      });    
  </script>
<!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">ItÃ©ration &amp; comprÃ©hension</h1>
<p class="author"><a href="mailto:Sebastien.Boisgerault@mines-paristech.fr">SÃ©bastien
BoisgÃ©rault</a></p>
<p class="date">Friday, 25 august 2023</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/github.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr">
          https://github.com/boisgera/python-fr
        </a>
</p>

<p>
<span style="display:inline-block;width:1em;position:relative;margin-right:0.25em">
<img height="auto" src="icons/git.svg" style="position:relative;top:0.15em;" width="100%"/>
</span>
<a href="https://github.com/boisgera/python-fr/commit/7da617f">
          #7da617f
        </a>
</p>
</header>
<details>
<summary>
<h2>Table des matiÃ¨res</h2>
</summary>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#itÃ©ration" id="toc-itÃ©ration">ItÃ©ration</a></li>
<li><a href="#itÃ©rables-classiques" id="toc-itÃ©rables-classiques">ItÃ©rables classiques</a></li>
<li><a href="#comprÃ©hensions" id="toc-comprÃ©hensions">ComprÃ©hensions</a></li>
<li><a href="#expressions-gÃ©nÃ©ratrices" id="toc-expressions-gÃ©nÃ©ratrices">Expressions gÃ©nÃ©ratrices</a></li>
</ul>
</nav></details>


<h1 id="itÃ©ration">ItÃ©ration</h1>
<p>On appelle <strong>itÃ©ration</strong> (ğŸ‡ºğŸ‡¸ <strong>iteration</strong>)
le processus qui consiste Ã  obtenir les Ã©lÃ©ments dâ€™une collection les
uns aprÃ¨s les autres. Câ€™est par example ce qui est Ã  lâ€™oeuvre dans une
boucle for</p>
<pre class="python"><code>for i in [1, 2, 3]:
    print(i)</code></pre>
<p>ou dans les expressions</p>
<pre class="python"><code>&gt;&gt;&gt; s = set([1, 2, 3])</code></pre>
<p>et</p>
<pre class="python"><code>&gt;&gt;&gt; m = max([0, 1, -1, 2, -2])</code></pre>
<p>Le point de dÃ©part est toujours un objet <strong>itÃ©rable</strong>
(ğŸ‡ºğŸ‡¸ <strong>iterable</strong>), câ€™est-Ã -dire capable de produire Ã  la
demande des <strong>itÃ©rateurs</strong> (ğŸ‡ºğŸ‡¸ <strong>iterators</strong>),
qui gÃ©nÃ¨rent les Ã©lements dÃ©sirÃ©s.</p>
<p>Le protocole qui permet dâ€™exploiter itÃ©rables et itÃ©rateurs exploite
les fonctions <code>iter</code> et <code>next</code> selon le schÃ©ma
suivant :</p>
<pre class="python"><code>&gt;&gt;&gt; iterable = [1, 2, 3]
&gt;&gt;&gt; iterator = iter(iterable)
&gt;&gt;&gt; next(iterator)
1
&gt;&gt;&gt; next(iterator)
2
&gt;&gt;&gt; next(iterator)
3
&gt;&gt;&gt; next(iterator)
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
StopIteration</code></pre>
<p>Notez que lâ€™itÃ©rateur ci-dessus â€œÃ©puiseâ€ progressivement lâ€™itÃ©rable
dont il est issu, jusquâ€™Ã  gÃ©nÃ©rer une erreur ; il nâ€™est alors plus
utilisable pour parcourir la liste. Mais il est bien sÃ»r dâ€™en produire
un nouveau avec la fonction <code>iter</code> et lâ€™itÃ©rable de
dÃ©part.</p>
<p>La boucle for envisagÃ©e plus haut exploite ce protocole. Elle est en
fait Ã©quivalente au code suivant :</p>
<pre class="python"><code>iterator = iter([1, 2, 3])
while True:
    try:
        i = next(iterator)
        print(i)
    except StopIteration:
        break</code></pre>
<p>âš ï¸ Ne pas modifier une collection pendant son itÃ©ration ! Le rÃ©sultat
serait indÃ©fini.</p>
<p>Au lieu dâ€™itÃ©rer la liste <code>l</code> dont on retire
progressivement les Ã©lÃ©ments</p>
<pre class="python"><code>l = [1, 2, 3]
for i in l:
    print(i)
    l.remove(i)</code></pre>
<p>on prÃ©fÃ©rera en itÃ©rer une copie</p>
<pre class="python"><code>l = [1, 2, 3]
for i in l.copy():
    print(i)
    l.remove(i)</code></pre>
<h1 id="itÃ©rables-classiques">ItÃ©rables classiques</h1>
<p>Sont itÃ©rables en particulier :</p>
<ul>
<li><p>les listes</p></li>
<li><p>les ensembles</p></li>
<li><p>les dictionnaires</p></li>
<li><p>les chaÃ®nes de caractÃ¨res</p></li>
<li><p>les fichiers</p></li>
<li><p>etc.</p></li>
</ul>
<p>Il existe Ã©galement des fonctions produisant des itÃ©rables, en
particulier</p>
<ul>
<li><p><code>range</code></p></li>
<li><p><code>enumerate</code></p></li>
<li><p><code>zip</code></p></li>
</ul>
<p>DÃ©monstration !</p>
<pre class="python"><code>&gt;&gt;&gt; range(10)
range(0, 10)
&gt;&gt;&gt; for i in range(10):
...     print(i)
... 
0
1
2
3
4
5
6
7
8
9</code></pre>
<pre class="python"><code>&gt;&gt;&gt; enumerate([6, 7, 8]) # doctest: +ELLIPSIS
&lt;enumerate object at 0x...&gt;
&gt;&gt;&gt; for i, number in enumerate([6, 7, 8]):
...     print(i, number)
... 
0 6
1 7
2 8</code></pre>
<pre class="python"><code>&gt;&gt;&gt; l1 = [1, 2, 3]
&gt;&gt;&gt; l2 = [4, 8, 16]
&gt;&gt;&gt; for item in zip(l1, l2):
...     print(item)
... 
(1, 4)
(2, 8)
(3, 16)</code></pre>
<h1 id="comprÃ©hensions">ComprÃ©hensions</h1>
<p>Les <strong>listes en comprÃ©hension</strong> ou pour faire court les
<strong>comprÃ©hensions</strong> (ğŸ‡ºğŸ‡¸ <strong>list comprehensions /
comprehensions</strong>) sont une alternative plus compacte aux boucles
pour construire des listes.</p>
<p>Par exemple, pour construire la liste des carrÃ©s des entiers de la
liste :</p>
<pre class="python"><code>integers = [1, 2, 3]</code></pre>
<p>on peut soit utiliser une boucle for :</p>
<pre class="python"><code>&gt;&gt;&gt; squares = []
&gt;&gt;&gt; for i in integers:
...     square = i * i
...     squares.append(square)
...
&gt;&gt;&gt; squares
[1, 4, 9]</code></pre>
<p>soit utiliser la comprÃ©hension</p>
<pre class="python"><code>&gt;&gt;&gt; [i*i for i in integers]
&gt;&gt;&gt;
[1, 4, 9]</code></pre>
<p>Il est Ã©galement possible de sÃ©lectionner les Ã©lÃ©ments que lâ€™on
conserve :</p>
<pre class="python"><code>&gt;&gt;&gt; def is_even(i):
...     return i % 2 == 0
...
&gt;&gt;&gt; integers = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt; [i for i in integers if is_even(i)]
[0, 2, 4, 6, 8]</code></pre>
<p>Les ensembles et les dictionnaires ont Ã©galement leur comprÃ©hensions
:</p>
<pre class="python"><code>&gt;&gt;&gt; {i*i for i in [0, 1, 2, 3] if i != 0}
{1, 4, 9}
&gt;&gt;&gt; {i: i*i for i in [0, 1, 2, 3] if i != 0}
{1: 1, 2: 4, 3: 9}</code></pre>
<h1 id="expressions-gÃ©nÃ©ratrices">Expressions gÃ©nÃ©ratrices</h1>
<p>Le calcul</p>
<pre class="python"><code>&gt;&gt;&gt; max([i*i for i in range(10)])
81</code></pre>
<p>a nÃ©cessitÃ© dâ€™allouer la liste <code>[x*x for x in range(10)]</code>
alors mÃªme que <code>range(10)</code> est un itÃ©rable paresseux, qui ne
produit de valeurs quâ€™au fur et Ã  mesure, sans nÃ©cessiter une telle
allocation de mÃ©moire.</p>
<p>On pourrait calculer le maximum nous-mÃªme en Ã©tant plus Ã©conome</p>
<pre class="python"><code>&gt;&gt;&gt; square_max = -1
&gt;&gt;&gt; for i in range(10):
...     square = i*i
...     if square &gt; square_max:
...         square_max = square
&gt;&gt;&gt; square_max
81  </code></pre>
<p>mais la construction suivante, qui utilise une <strong>expression
gÃ©nÃ©ratrice</strong> (ğŸ‡ºğŸ‡¸ <strong>generation expression</strong>) est
trÃ¨s similaire Ã  notre code initial mais nâ€™a pas lâ€™inconvÃ©nient de
celui-ci</p>
<pre class="python"><code>&gt;&gt;&gt; max((x*x for x in range(10)))
81</code></pre>
<p>Lâ€™expression <code>(x*x for x in range(10))</code> est un itÃ©rable
qui produit ses valeurs au fur et Ã  mesure. Dans le contexte
dâ€™utilisation ci-dessus, on peut mÃªme faire lâ€™Ã©conomie des parenthÃ¨ses
dÃ©crivant lâ€™expression et se contenter dâ€™Ã©crire</p>
<pre class="python"><code>&gt;&gt;&gt; max(x*x for x in range(10))
81</code></pre>
<p>Cela nâ€™est toutefois pas vrai dans tous les contextes ; on a
ainsi</p>
<pre class="python"><code>&gt;&gt;&gt; x*x for x in range(10)
  File "&lt;stdin&gt;", line 1
    x*x for x in range(10)
        ^
SyntaxError: invalid syntax</code></pre>
<p>mais</p>
<pre class="python"><code>&gt;&gt;&gt; (x*x for x in range(10)) # doctest: +ELLIPSIS
&lt;generator object &lt;genexpr&gt; at 0x...&gt;</code></pre>
</body>
</html>
